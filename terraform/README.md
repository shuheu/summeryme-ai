# Summeryme AI Backend - Terraform Configuration

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Summeryme AI Backendã®GCPãƒªã‚½ãƒ¼ã‚¹ã‚’Terraformã§ç®¡ç†ã™ã‚‹ãŸã‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ—„ï¸ çŠ¶æ…‹ç®¡ç†ï¼ˆGCS Backendï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Terraformã®çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Google Cloud Storageï¼ˆGCSï¼‰ã§ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚

### GCS Backendè¨­å®š
- **ãƒã‚±ãƒƒãƒˆ**: `{PROJECT_ID}-terraform-state`ï¼ˆå‹•çš„ã«è¨­å®šï¼‰
- **ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹**: `summeryme-ai/backend`ï¼ˆ`providers.tf`ã§å®šç¾©ï¼‰
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**: æœ‰åŠ¹
- **å ´æ‰€**: asia-northeast1

### ğŸ” è¨­å®šæ–¹æ³•

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã¯`locals.tf`ã§å¤‰æ•°ã¨ã—ã¦ç®¡ç†ã•ã‚Œã€åˆæœŸåŒ–æ™‚ã«å‹•çš„ã«è¨­å®šã•ã‚Œã¾ã™ï¼š

```bash
# GCSãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§åˆæœŸåŒ–
make init

# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
terraform init -backend-config="bucket=$(gcloud config get-value project)-terraform-state"
```

### çŠ¶æ…‹ç®¡ç†ã‚³ãƒãƒ³ãƒ‰
```bash
# GCSãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§åˆæœŸåŒ–
make init

# ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‹ã‚‰GCSã«ç§»è¡Œ
make migrate-to-gcs

# ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
make backup-local-state

# ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã§åˆæœŸåŒ–ï¼ˆé–‹ç™ºç”¨ï¼‰
make init-local

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šæƒ…å ±ã‚’ç¢ºèª
terraform output backend_configuration
```

### åˆ©ç‚¹
- **ãƒãƒ¼ãƒ å…±æœ‰**: è¤‡æ•°ã®é–‹ç™ºè€…ãŒåŒã˜çŠ¶æ…‹ã‚’å…±æœ‰
- **å®‰å…¨æ€§**: çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã®æš—å·åŒ–ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°
- **CI/CDå¯¾å¿œ**: GitHub Actionsã§ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **ãƒ­ãƒƒã‚¯æ©Ÿèƒ½**: åŒæ™‚å®Ÿè¡Œã®é˜²æ­¢

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æº–æ‹ ï¼‰

```
terraform/
â”œâ”€â”€ main.tf                    # ãƒ¡ã‚¤ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ¦‚è¦ã¨ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
â”œâ”€â”€ providers.tf               # ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®šã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ¶ç´„
â”œâ”€â”€ locals.tf                  # ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°å®šç¾©
â”œâ”€â”€ variables.tf               # å…¥åŠ›å¤‰æ•°å®šç¾©
â”œâ”€â”€ outputs.tf                 # å‡ºåŠ›å€¤å®šç¾©
â”œâ”€â”€ apis.tf                    # Google Cloud APIsæœ‰åŠ¹åŒ–
â”œâ”€â”€ secrets.tf                 # Secret Managerè¨­å®š
â”œâ”€â”€ cloud_sql.tf               # Cloud SQLè¨­å®š
â”œâ”€â”€ iam.tf                     # IAMï¼ˆã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ»æ¨©é™ï¼‰
â”œâ”€â”€ cloud_run.tf               # Cloud Runï¼ˆã‚µãƒ¼ãƒ“ã‚¹ãƒ»ã‚¸ãƒ§ãƒ–ï¼‰
â”œâ”€â”€ terraform.tfvars.example   # å¤‰æ•°å€¤ã®ã‚µãƒ³ãƒ—ãƒ«
â”œâ”€â”€ terraform.tfvars           # å®Ÿéš›ã®å¤‰æ•°å€¤ï¼ˆGité™¤å¤–ï¼‰
â”œâ”€â”€ .gitignore                 # Gité™¤å¤–è¨­å®š
â”œâ”€â”€ Makefile                   # æ“ä½œã‚’ç°¡å˜ã«ã™ã‚‹Makefile
â””â”€â”€ README.md                  # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

### ğŸ—ï¸ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®åŸå‰‡

ã“ã®æ§‹æˆã¯ã€Terraformã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã£ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ï¼š

1. **æ©Ÿèƒ½åˆ¥åˆ†é›¢**: å„ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã‚’å°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢
2. **æ˜ç¢ºãªå‘½å**: ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰å†…å®¹ãŒåˆ†ã‹ã‚Šã‚„ã™ã„
3. **ä¾å­˜é–¢ä¿‚ã®æ˜ç¢ºåŒ–**: ãƒªã‚½ãƒ¼ã‚¹é–“ã®ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤º
4. **å†åˆ©ç”¨æ€§**: ç’°å¢ƒåˆ¥ã®è¨­å®šã‚’å¤‰æ•°ã§åˆ¶å¾¡
5. **ä¿å®ˆæ€§**: ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã¨ä¿å®ˆæ€§ã‚’é‡è¦–

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. å‰ææ¡ä»¶

```bash
# Terraformã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
brew install terraform

# Google Cloud SDKã®èªè¨¼
gcloud auth login
gcloud auth application-default login
gcloud config set project your-gcp-project-id
```

### 2. åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
make dev-setup

# åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆterraform.tfvarsä½œæˆï¼‰
make setup
```

### 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†

```bash
# å¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
vim terraform.tfvars
```

å¿…è¦ãªå¤‰æ•°ï¼š
```hcl
project_id      = "your-gcp-project-id"
container_image = "asia-northeast1-docker.pkg.dev/your-project/repo/image"
```

### 4. Terraformã®å®Ÿè¡Œ

```bash
# å®Ÿè¡Œè¨ˆç”»ã®ç¢ºèª
make plan

# ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆãƒ»æ›´æ–°
make apply

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
make migrate
```

## ğŸ”§ ç®¡ç†ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹

### Google Cloud APIs
- Cloud Run API
- Cloud SQL Admin API
- Secret Manager API
- Cloud Build API
- Container Registry API
- Artifact Registry API
- Cloud Logging API
- Cloud Monitoring API
- Compute API
- Service Networking API
- VPC Access API

### Artifact Registry
- **ãƒªãƒã‚¸ãƒˆãƒª**: `backend`
- **å½¢å¼**: Docker
- **å ´æ‰€**: asia-northeast1
- **ç”¨é€”**: Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä¿å­˜

### Cloud SQL
- **ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**: `summeryme-db`
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: `summeryme_production`
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: `summeryme_user`
- **è¨­å®š**: MySQL 8.0, db-f1-micro, 10GB HDD

### Secret Manager
- **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**: `db-password`
- **å†…å®¹**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰

### Google Cloud Storage
- **ãƒã‚±ãƒƒãƒˆ**: `{PROJECT_ID}-summeryme-audio`
- **ç”¨é€”**: éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜
- **ã‚¢ã‚¯ã‚»ã‚¹**: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆï¼ˆèªè¨¼ãŒå¿…è¦ï¼‰

### Cloud Run
- **ã‚µãƒ¼ãƒ“ã‚¹**: `backend-api`
- **è¨­å®š**: 1 vCPU, 1GB RAM, 0-10ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
- **èªè¨¼**: å°‚ç”¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

### Cloud Run Job
- **ã‚¸ãƒ§ãƒ–**: `migrate-job`
- **ç”¨é€”**: Prismaãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

### IAM
- **ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**: `backend-api-sa`, `github-actions`
- **æ¨©é™**: Cloud SQLæ¥ç¶šã€Secret Managerèª­ã¿å–ã‚Š

## ğŸ“Š å¤‰æ•°ä¸€è¦§

### å¿…é ˆå¤‰æ•°

| å¤‰æ•°å | èª¬æ˜ | ä¾‹ |
|--------|------|-----|
| `project_id` | GCPãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID | `your-gcp-project-id` |
| `container_image` | ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸URL | `asia-northeast1-docker.pkg.dev/...` |

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¤‰æ•°

| å¤‰æ•°å | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ |
|--------|------|-------------|
| `region` | GCPãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | `asia-northeast1` |
| `environment` | ç’°å¢ƒå | `production` |
| `db_tier` | Cloud SQLãƒ†ã‚£ã‚¢ | `db-f1-micro` |
| `db_disk_size` | Cloud SQLãƒ‡ã‚£ã‚¹ã‚¯ã‚µã‚¤ã‚º(GB) | `10` |
| `cpu_limit` | CPUåˆ¶é™ | `1000m` |
| `memory_limit` | ãƒ¡ãƒ¢ãƒªåˆ¶é™ | `1Gi` |
| `min_instances` | æœ€å°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•° | `0` |
| `max_instances` | æœ€å¤§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•° | `10` |
| `log_level` | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« | `info` |
| `allow_public_access` | ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ | `true` |

è©³ç´°ãªå¤‰æ•°èª¬æ˜ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã¯ `variables.tf` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“¤ å‡ºåŠ›å€¤

å®Ÿè¡Œå¾Œã«ä»¥ä¸‹ã®æƒ…å ±ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```bash
# å‡ºåŠ›å€¤ã®ç¢ºèª
make output

# ç‰¹å®šã®å€¤ã®ã¿è¡¨ç¤º
terraform output cloud_run_service_url
```

ä¸»ãªå‡ºåŠ›å€¤ï¼š
- `cloud_run_service_url`: Cloud Runã‚µãƒ¼ãƒ“ã‚¹ã®URL
- `cloud_sql_instance_connection_name`: Cloud SQLæ¥ç¶šå
- `useful_commands`: ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰é›†
- `resource_summary`: ãƒªã‚½ãƒ¼ã‚¹ã‚µãƒãƒªãƒ¼

## ğŸ”„ ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬æ“ä½œ
```bash
make help           # ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
make setup          # åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
make plan           # å®Ÿè¡Œè¨ˆç”»ç¢ºèª
make apply          # ãƒªã‚½ãƒ¼ã‚¹ä½œæˆãƒ»æ›´æ–°
make destroy        # å…¨ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤
```

### ç¢ºèªãƒ»æ¤œè¨¼
```bash
make check          # ã‚³ãƒ¼ãƒ‰æ¤œè¨¼ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
make state          # ãƒªã‚½ãƒ¼ã‚¹çŠ¶æ…‹è¡¨ç¤º
make output         # å‡ºåŠ›å€¤è¡¨ç¤º
make project-info   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±è¡¨ç¤º
```

### éƒ¨åˆ†çš„ãªé©ç”¨
```bash
make apply-apis     # Google Cloud APIã®ã¿
make apply-secrets  # Secret Managerã®ã¿
make apply-cloud-sql # Cloud SQLã®ã¿
make apply-iam      # IAMã®ã¿
make apply-cloud-run # Cloud Runã®ã¿
```

### ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```bash
make import-check   # ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ãƒªã‚½ãƒ¼ã‚¹ç¢ºèª
make import-all     # å…¨ãƒªã‚½ãƒ¼ã‚¹ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
make import-cloud-run # Cloud Runã®ã¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
make import-cloud-sql # Cloud SQLã®ã¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```

### ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
```bash
make migrate        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
make backup-state   # ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
make security-scan  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
make clean          # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
```

## ğŸ”„ æ—¢å­˜ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

æ—¢ã«GCPã«ä½œæˆæ¸ˆã¿ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’Terraformã®ç®¡ç†ä¸‹ã«ç§»è¡Œã™ã‚‹æ‰‹é †ã§ã™ã€‚

### ğŸ“‹ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰ã®ç¢ºèª

```bash
# ç¾åœ¨ã®ãƒªã‚½ãƒ¼ã‚¹çŠ¶æ³ã‚’ç¢ºèª
make import-check

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±ã‚’ç¢ºèª
make project-info
```

### ğŸš€ ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆæ¨å¥¨ï¼‰

```bash
# å…¨ã¦ã®æ—¢å­˜ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¸€æ‹¬ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
make import-all
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã®é †åºã§å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š
1. **APIã‚µãƒ¼ãƒ“ã‚¹** - å¿…è¦ãªGoogle Cloud APIã‚’æœ‰åŠ¹åŒ–
2. **Secret Manager** - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç®¡ç†
3. **Cloud SQL** - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€DBã€ãƒ¦ãƒ¼ã‚¶ãƒ¼
4. **ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ** - Cloud Runã€GitHub Actionsç”¨
5. **Cloud Run** - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã¨IAMè¨­å®š

### ğŸ”§ å€‹åˆ¥ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã®ã¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸã„å ´åˆï¼š

```bash
make import-apis        # APIã‚µãƒ¼ãƒ“ã‚¹
make import-secret      # Secret Manager
make import-cloud-sql   # Cloud SQL
make import-iam         # ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
make import-cloud-run   # Cloud Run
```

### âš ï¸ ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ™‚ã®æ³¨æ„ç‚¹

1. **æ—¢å­˜ãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºèª**
   - ã‚¤ãƒ³ãƒãƒ¼ãƒˆå‰ã«`make import-check`ã§å¯¾è±¡ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèª
   - å­˜åœ¨ã—ãªã„ãƒªã‚½ãƒ¼ã‚¹ã¯æ–°è¦ä½œæˆã•ã‚Œã‚‹

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - æ—¢ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ¸ˆã¿ã®ãƒªã‚½ãƒ¼ã‚¹ã¯ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹
   - ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯ç¶™ç¶š

3. **è¨­å®šã®å·®åˆ†**
   - ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œã¯`make plan`ã§è¨­å®šå·®åˆ†ã‚’ç¢ºèª
   - å¿…è¦ã«å¿œã˜ã¦`make apply`ã§è¨­å®šã‚’åŒæœŸ

### ğŸ“Š ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¾Œã®ç¢ºèª

```bash
# Terraformã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§
make state

# è¨­å®šå·®åˆ†ã®ç¢ºèª
make plan

# è¨­å®šã®åŒæœŸï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
make apply
```

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### State ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
æœ¬ç•ªç’°å¢ƒã§ã¯ã€stateãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒ¢ãƒ¼ãƒˆã§ç®¡ç†ã™ã‚‹ã“ã¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ï¼š

```hcl
# providers.tf ã®backendè¨­å®šã‚’æœ‰åŠ¹åŒ–
terraform {
  backend "gcs" {
    bucket = "your-terraform-state-bucket"
    prefix = "summeryme-ai/backend"
  }
}
```

### æ©Ÿå¯†æƒ…å ±
- `terraform.tfvars`ãƒ•ã‚¡ã‚¤ãƒ«ã¯`.gitignore`ã«å«ã¾ã‚Œã¦ã„ã¾ã™
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã€Secret Managerã§ç®¡ç†ã•ã‚Œã¾ã™
- å‡ºåŠ›å€¤ã®ä¸€éƒ¨ã¯`sensitive = true`ã§ãƒã‚¹ã‚¯ã•ã‚Œã¦ã„ã¾ã™

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- å…¨ã¦ã®å¤‰æ•°ã«é©åˆ‡ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®š
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒªã‚½ãƒ¼ã‚¹åã®å½¢å¼ãƒã‚§ãƒƒã‚¯
- æ•°å€¤ç¯„å›²ã®åˆ¶é™ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®æ¤œè¨¼

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **APIæœ‰åŠ¹åŒ–ã‚¨ãƒ©ãƒ¼**
   ```bash
   # æ‰‹å‹•ã§APIã‚’æœ‰åŠ¹åŒ–
   make apply-apis
   ```

2. **æ¨©é™ã‚¨ãƒ©ãƒ¼**
   ```bash
   # å¿…è¦ãªæ¨©é™ã‚’ç¢ºèª
   gcloud projects get-iam-policy PROJECT_ID
   ```

3. **State ãƒ­ãƒƒã‚¯**
   ```bash
   # ãƒ­ãƒƒã‚¯ã®å¼·åˆ¶è§£é™¤ï¼ˆæ³¨æ„ã—ã¦ä½¿ç”¨ï¼‰
   terraform force-unlock LOCK_ID
   ```

4. **ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼**
   ```bash
   # ç‰¹å®šãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ç¢ºèª
   make state

   # å•é¡Œã®ã‚ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰å†ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
   terraform state rm google_cloud_run_v2_service.main
   make import-cloud-run
   ```

### ãƒ­ã‚°ç¢ºèª
```bash
# Terraformã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
make debug

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
make security-scan
```

## ğŸ“š å‚è€ƒè³‡æ–™

- [Terraform Google Provider Documentation](https://registry.terraform.io/providers/hashicorp/google/latest/docs)
- [Google Cloud Run Terraform Examples](https://cloud.google.com/run/docs/terraform)
- [Terraform Best Practices](https://www.terraform.io/docs/cloud/guides/recommended-practices/index.html)
- [Terraform Configuration Language](https://www.terraform.io/docs/language/index.html)

## ğŸ† ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
- âœ… æ©Ÿèƒ½åˆ¥ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†é›¢
- âœ… æ˜ç¢ºã§ä¸€è²«ã—ãŸå‘½åè¦å‰‡
- âœ… é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆã¨èª¬æ˜

### ã‚³ãƒ¼ãƒ‰å“è³ª
- âœ… å…¨å¤‰æ•°ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
- âœ… é©åˆ‡ãªä¾å­˜é–¢ä¿‚ã®å®šç¾©
- âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã®æ˜ç¤º

### é‹ç”¨
- âœ… ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ä½¿ç”¨
- âœ… å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
- âœ… ã‚¹ãƒ†ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

---

**æœ€çµ‚æ›´æ–°**: 2025-05-31
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0.0 (ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æº–æ‹ ç‰ˆ)

## ğŸ”„ ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´

### v2.1.0 (2025-06-22)
- âœ¨ Cloud Schedulerã‚µãƒãƒ¼ãƒˆè¿½åŠ 
- âœ¨ ãƒãƒƒãƒã‚¸ãƒ§ãƒ–ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œå¯¾å¿œ
- âœ¨ Cloud Storageãƒã‚±ãƒƒãƒˆè¿½åŠ 
- âœ¨ Gemini APIã‚­ãƒ¼ç®¡ç†è¿½åŠ 

### v2.0.0 (2025-05-31)
- âœ¨ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«æ²¿ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã«å¤‰æ›´
- âœ¨ æ©Ÿèƒ½åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«åˆ†é›¢ï¼ˆproviders.tf, locals.tf, apis.tfç­‰ï¼‰
- âœ¨ è©³ç´°ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«è¿½åŠ 
- âœ¨ æ”¹å–„ã•ã‚ŒãŸMakefileã‚³ãƒãƒ³ãƒ‰
- âœ¨ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå……å®Ÿ

### v1.0.0 (2025-05-30)
- ğŸ‰ åˆæœŸãƒªãƒªãƒ¼ã‚¹
- åŸºæœ¬çš„ãªTerraformè¨­å®š
- Cloud Runã€Cloud SQLã€Secret Managerå¯¾å¿œ